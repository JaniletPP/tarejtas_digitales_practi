<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Saltillo, Coahuila</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <!-- Navbar √∫nico integrado - ESTRUCTURA CORRECTA -->
    <header class="admin-navbar">
        <nav class="admin-nav-horizontal">
            <!-- Secci√≥n Izquierda: Logo + T√≠tulo -->
            <div class="navbar-left">
                <div class="navbar-logo">
                    <span class="logo-icon">üèîÔ∏è</span>
                    <span class="logo-text"><span>S</span>istema de Tarjetas Inteligentes</span>
                </div>
            </div>

            <!-- Secci√≥n Centro: Men√∫ -->
            <div class="navbar-center">
                <!-- Men√∫ desplegable: Gesti√≥n -->
                <div class="nav-menu-item dropdown">
                    <a href="#gestion" class="nav-link dropdown-toggle" data-toggle="gestion">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span class="nav-text">Gesti√≥n</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </a>
                    <ul class="dropdown-menu" id="dropdown-gestion">
                        <li><a href="#asistentes" class="dropdown-item" data-section="asistentes">
                            <span class="dropdown-icon">üë•</span>
                            Asistentes
                        </a></li>
                        <li><a href="#tarjetas" class="dropdown-item" data-section="tarjetas">
                            <span class="dropdown-icon">üí≥</span>
                            Tarjetas
                        </a></li>
                        <li><a href="#productos" class="dropdown-item" data-section="productos">
                            <span class="dropdown-icon">üõçÔ∏è</span>
                            Productos
                        </a></li>
                    </ul>
                </div>

                <!-- Men√∫ desplegable: Reportes -->
                <div class="nav-menu-item dropdown">
                    <a href="#reportes" class="nav-link dropdown-toggle" data-toggle="reportes">
                        <span class="nav-icon">üìà</span>
                        <span class="nav-text">Reportes</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </a>
                    <ul class="dropdown-menu" id="dropdown-reportes">
                        <li><a href="#reportes-ventas" class="dropdown-item" data-section="reportes">
                            <span class="dropdown-icon">üí∞</span>
                            Ventas
                        </a></li>
                        <li><a href="#reportes-transacciones" class="dropdown-item" data-section="reportes-transacciones">
                            <span class="dropdown-icon">üìú</span>
                            Transacciones
                        </a></li>
                    </ul>
                </div>

                <!-- Men√∫ Caja -->
                <div class="nav-menu-item">
                    <a href="#caja" class="nav-link" data-section="caja">
                        <span class="nav-icon">üí∞</span>
                        <span class="nav-text">Caja</span>
                    </a>
                </div>

                <!-- Men√∫ Punto de Venta -->
                <div class="nav-menu-item">
                    <a href="#punto-venta" class="nav-link" data-section="punto-venta">
                        <span class="nav-icon">üõí</span>
                        <span class="nav-text">Punto de Venta</span>
                    </a>
                </div>

                <!-- Men√∫ Configuraci√≥n -->
                <div class="nav-menu-item">
                    <a href="#configuracion" class="nav-link" data-section="configuracion">
                        <span class="nav-icon">üîß</span>
                        <span class="nav-text">Configuraci√≥n</span>
                    </a>
                </div>
            </div>

            <!-- Secci√≥n Derecha: Usuario + Salir -->
            <div class="navbar-right">
                <div class="navbar-user">
                    <span class="user-avatar">üë§</span>
                    <span class="user-name">{{ session.usuario }}</span>
                </div>
                <a href="{{ url_for('auth.logout') }}" class="btn-logout-navbar">
                    Salir
                </a>
            </div>
        </nav>
    </header>

    <div class="admin-wrapper">

        <!-- Main Content (con margin-top para el header fijo) -->
        <main class="admin-content">
            <!-- Dashboard Section -->
            <section id="section-dashboard" class="admin-section active">
                <div class="stats-grid">
                    <div class="stat-card stat-primary">
                        <div class="stat-icon-wrapper">
                            <div class="stat-icon">üë•</div>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Asistentes Registrados</div>
                            <div class="stat-value" id="totalAsistentes">-</div>
                        </div>
                    </div>
                    <div class="stat-card stat-success">
                        <div class="stat-icon-wrapper">
                            <div class="stat-icon">üí≥</div>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Tarjetas Activas</div>
                            <div class="stat-value" id="totalTarjetas">-</div>
                        </div>
                    </div>
                    <div class="stat-card stat-warning">
                        <div class="stat-icon-wrapper">
                            <div class="stat-icon">üí∞</div>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Saldo Total en Sistema</div>
                            <div class="stat-value" id="totalSaldo">-</div>
                        </div>
                    </div>
                    <div class="stat-card stat-info">
                        <div class="stat-icon-wrapper">
                            <div class="stat-icon">üìä</div>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Transacciones Hoy</div>
                            <div class="stat-value" id="totalTransacciones">-</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Asistentes Section -->
            <section id="section-asistentes" class="admin-section hidden">
                <div class="section-header">
                    <h2>üë• Gesti√≥n de Asistentes</h2>
                    <button class="btn btn-primary" id="btnNuevoAsistente">‚ûï Nuevo Asistente</button>
                </div>
                
                <!-- Filtros y acciones -->
                <div class="content-card">
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <button class="btn btn-secondary" id="btnCargarAsistentes">üîÑ Cargar Lista</button>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de asistentes -->
                <div class="content-card">
                    <div id="listaAsistentesAdmin" class="resultado"></div>
                </div>
            </section>

            <!-- Tarjetas Section -->
            <section id="section-tarjetas" class="admin-section hidden">
                <h2>üí≥ Gesti√≥n de Tarjetas</h2>
                <div class="grid">
                    <div class="content-card">
                        <h3>Asignar Tarjeta</h3>
                        <form id="formAsignarTarjetaAdmin">
                            <!-- Selector de Asistente -->
                            <div class="form-group">
                                <label>Asistente *</label>
                                <div class="asistente-selector-container">
                                    <input 
                                        type="text" 
                                        id="buscarAsistenteAdmin" 
                                        class="asistente-search-input"
                                        placeholder="Buscar por nombre, tel√©fono o email..."
                                        autocomplete="off"
                                    >
                                    <div id="asistenteDropdown" class="asistente-dropdown"></div>
                                    <input type="hidden" id="asistente_id_admin" required>
                                    <div id="asistenteSeleccionado" class="asistente-seleccionado" style="display: none;">
                                        <div class="asistente-info">
                                            <span class="asistente-nombre" id="asistenteNombreMostrar"></span>
                                            <span class="asistente-contacto" id="asistenteContactoMostrar"></span>
                            </div>
                                        <button type="button" class="btn-clear-asistente" id="btnClearAsistente">√ó</button>
                                    </div>
                                </div>
                                <small class="form-help">Escribe para buscar asistentes sin tarjeta asignada. Se mostrar√° nombre completo y contacto.</small>
                            </div>

                            <!-- N√∫mero de Tarjeta -->
                            <div class="form-group">
                                <label>N√∫mero de Tarjeta *</label>
                                <div class="tarjeta-input-container" style="display: flex; gap: 10px; align-items: center;">
                                    <input 
                                        type="text" 
                                        id="numero_tarjeta_admin" 
                                        placeholder="TARJ-XXXXXX"
                                        required
                                        pattern="TARJ-[0-9]{6}"
                                        maxlength="11"
                                        style="flex: 1;"
                                    >
                                    <button type="button" class="btn btn-secondary" id="btnScanQRTarjeta" style="white-space: nowrap;">
                                        üì∑ Escanear QR
                                    </button>
                                </div>
                                <div id="tarjetaEstado" class="tarjeta-estado" style="display: none;"></div>
                                <small class="form-help">Ingresa el n√∫mero de tarjeta en formato TARJ-XXXXXX o escanea el c√≥digo QR.</small>
                            </div>

                            <!-- Vista Previa -->
                            <div id="vistaPreviaAsignacion" class="vista-previa-asignacion" style="display: none;">
                                <h4>üìã Vista Previa de Asignaci√≥n</h4>
                                <div class="preview-content">
                                    <div class="preview-item">
                                        <span class="preview-label">Asistente:</span>
                                        <span class="preview-value" id="previewAsistente">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span class="preview-label">Contacto:</span>
                                        <span class="preview-value" id="previewContacto">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span class="preview-label">Estado del Asistente:</span>
                                        <span class="preview-value success" id="previewEstadoAsistente">‚úÖ Sin tarjeta asignada</span>
                                    </div>
                                    <div class="preview-item">
                                        <span class="preview-label">N√∫mero de Tarjeta:</span>
                                        <span class="preview-value" id="previewTarjeta">-</span>
                                    </div>
                                    <div class="preview-item">
                                        <span class="preview-label">Estado de la Tarjeta:</span>
                                        <span class="preview-value" id="previewEstado">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Botones de Acci√≥n -->
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="btnLimpiarFormulario">Limpiar</button>
                                <button type="submit" class="btn btn-primary" id="btnAsignarTarjeta">
                                    <span class="btn-text">Asignar Tarjeta</span>
                                    <span class="btn-loader" style="display: none;">‚è≥</span>
                                </button>
                            </div>
                        </form>
                        <div id="resultadoAsignarAdmin" class="resultado"></div>
                    </div>
                    <div class="content-card">
                        <h3>Consultar Tarjeta</h3>
                        <form id="formConsultarTarjetaAdmin">
                            <div class="form-group">
                                <label>N√∫mero de Tarjeta *</label>
                                <input type="text" id="numero_tarjeta_consulta_admin" placeholder="TARJ-XXXXXX" required>
                            </div>
                            <button type="submit" class="btn btn-info">Consultar</button>
                        </form>
                        <div id="resultadoConsultaAdmin" class="resultado"></div>
                    </div>
                </div>
            </section>

            <!-- Productos Section -->
            <section id="section-productos" class="admin-section hidden">
                <div class="section-header">
                    <h2>üõçÔ∏è Gesti√≥n de Productos</h2>
                    <button class="btn btn-primary" id="btnNuevoProductoAdmin">‚ûï Nuevo Producto</button>
                </div>

                <!-- Filtros y b√∫squeda -->
                <div class="content-card">
                    <div class="productos-filtros">
                        <div class="filtro-group">
                            <label>Filtrar por tipo:</label>
                            <select id="filtroTipoProductosAdmin" class="filtro-select-admin">
                                <option value="">Todos los tipos</option>
                            </select>
                        </div>
                        <div class="filtro-group">
                            <label>Buscar:</label>
                            <input type="text" id="buscarProductoAdmin" class="filtro-select-admin" placeholder="Buscar por nombre...">
                        </div>
                        <div class="filtro-group">
                            <label>
                                <input type="checkbox" id="mostrarNoDisponibles" checked style="margin-right: 5px;">
                                Mostrar no disponibles
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Productos organizados por tipo -->
                <div id="productosPorTipoAdmin" class="productos-por-tipo">
                    <!-- Los productos se cargan din√°micamente organizados por tipo -->
                </div>
            </section>

            <!-- Reportes Section -->
            <section id="section-reportes" class="admin-section hidden">
                <div class="section-header">
                <h2>üìà Reportes de Ventas</h2>
                    <button class="btn btn-primary" id="btnExportarVentas" style="display: none;">üì• Exportar CSV</button>
                </div>
                
                <!-- Filtros -->
                <div class="content-card">
                    <h3>Filtros</h3>
                    <form id="formFiltrosVentas" class="filtros-reporte">
                        <div class="filtros-grid">
                            <div class="form-group">
                                <label>Fecha Inicio</label>
                                <input type="date" id="fechaInicioVentas" class="filtro-input">
                            </div>
                            <div class="form-group">
                                <label>Fecha Fin</label>
                                <input type="date" id="fechaFinVentas" class="filtro-input">
                            </div>
                            <div class="form-group">
                                <label>Punto de Venta</label>
                                <select id="puntoVentaVentas" class="filtro-input">
                                    <option value="">Todos los puntos de venta</option>
                                </select>
                            </div>
                            <div class="form-group form-actions-inline">
                                <button type="submit" class="btn btn-primary">üîç Aplicar Filtros</button>
                                <button type="button" class="btn btn-secondary" id="btnLimpiarFiltrosVentas">üîÑ Limpiar</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Resumen -->
                <div id="resumenVentas" class="resumen-reporte" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card stat-primary">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">üí∞</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Total Ventas</div>
                                <div class="stat-value" id="totalVentas">-</div>
                            </div>
                        </div>
                        <div class="stat-card stat-success">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">üíµ</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Monto Total</div>
                                <div class="stat-value" id="montoTotalVentas">-</div>
                            </div>
                        </div>
                        <div class="stat-card stat-info">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">üìä</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Promedio por Venta</div>
                                <div class="stat-value" id="promedioVenta">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Ventas -->
                <div class="content-card">
                    <div id="tablaVentasContainer" style="display: none;">
                        <div class="table-header">
                            <h3>Detalle de Ventas</h3>
                            <div class="table-actions">
                                <span id="contadorVentas" class="contador-registros"></span>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table id="tablaVentas" class="reporte-table">
                                <thead>
                                    <tr>
                                        <th>Fecha/Hora</th>
                                        <th>Punto de Venta</th>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Precio Unit.</th>
                                        <th>Total</th>
                                        <th>Tarjeta</th>
                                        <th>Asistente</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyVentas">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="sinDatosVentas" class="sin-datos">
                        <p>üëÜ Selecciona filtros y haz clic en "Aplicar Filtros" para ver el reporte</p>
                    </div>
                </div>

                <!-- Resumen por Punto de Venta y Productos M√°s Vendidos -->
                <div class="grid" id="resumenDetalladoVentas" style="display: none;">
                    <div class="content-card">
                        <h3>Ventas por Punto de Venta</h3>
                        <div class="table-wrapper">
                            <table class="reporte-table resumen-table">
                                <thead>
                                    <tr>
                                        <th>Punto de Venta</th>
                                        <th>Total Ventas</th>
                                        <th>Monto Total</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyVentasPorPV">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="content-card">
                        <h3>Productos M√°s Vendidos</h3>
                        <div class="table-wrapper">
                            <table class="reporte-table resumen-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyProductosMasVendidos">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transacciones Section -->
            <section id="section-reportes-transacciones" class="admin-section hidden">
                <div class="section-header">
                <h2>üìú Reportes de Transacciones</h2>
                    <button class="btn btn-primary" id="btnExportarTransacciones" style="display: none;">üì• Exportar CSV</button>
                </div>
                
                <!-- Filtros -->
                <div class="content-card">
                    <h3>Filtros</h3>
                    <form id="formFiltrosTransacciones" class="filtros-reporte">
                        <div class="filtros-grid">
                            <div class="form-group">
                                <label>Fecha Inicio</label>
                                <input type="date" id="fechaInicioTransacciones" class="filtro-input">
                            </div>
                            <div class="form-group">
                                <label>Fecha Fin</label>
                                <input type="date" id="fechaFinTransacciones" class="filtro-input">
                            </div>
                            <div class="form-group">
                                <label>Tipo</label>
                                <select id="tipoTransaccion" class="filtro-input">
                                    <option value="">Todos los tipos</option>
                                    <option value="recarga">Recarga</option>
                                    <option value="pago">Pago</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Punto de Venta</label>
                                <select id="puntoVentaTransacciones" class="filtro-input">
                                    <option value="">Todos los puntos de venta</option>
                                </select>
                            </div>
                            <div class="form-group form-actions-inline">
                                <button type="submit" class="btn btn-primary">üîç Aplicar Filtros</button>
                                <button type="button" class="btn btn-secondary" id="btnLimpiarFiltrosTransacciones">üîÑ Limpiar</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Resumen -->
                <div id="resumenTransacciones" class="resumen-reporte" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card stat-primary">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">üìä</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Total Transacciones</div>
                                <div class="stat-value" id="totalTransaccionesReporte">-</div>
                            </div>
                        </div>
                        <div class="stat-card stat-success">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">‚ûï</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Total Recargas</div>
                                <div class="stat-value" id="totalRecargas">-</div>
                            </div>
                        </div>
                        <div class="stat-card stat-warning">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">‚ûñ</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Total Pagos</div>
                                <div class="stat-value" id="totalPagos">-</div>
                            </div>
                        </div>
                        <div class="stat-card stat-info">
                            <div class="stat-icon-wrapper">
                                <div class="stat-icon">üí∞</div>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Diferencia</div>
                                <div class="stat-value" id="diferenciaTransacciones">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Transacciones -->
                <div class="content-card">
                    <div id="tablaTransaccionesContainer" style="display: none;">
                        <div class="table-header">
                            <h3>Detalle de Transacciones</h3>
                            <div class="table-actions">
                                <span id="contadorTransacciones" class="contador-registros"></span>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table id="tablaTransacciones" class="reporte-table">
                                <thead>
                                    <tr>
                                        <th>Fecha/Hora</th>
                                        <th>Tipo</th>
                                        <th>Monto</th>
                                        <th>Tarjeta</th>
                                        <th>Asistente</th>
                                        <th>Punto de Venta</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyTransacciones">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="sinDatosTransacciones" class="sin-datos">
                        <p>üëÜ Selecciona filtros y haz clic en "Aplicar Filtros" para ver el reporte</p>
                    </div>
                </div>
            </section>

            <!-- Configuraci√≥n Section -->
            <!-- Perfil Section -->
            <section id="section-perfil" class="admin-section hidden">
                <h2>üë§ Mi Perfil</h2>
                <div class="grid">
                    <div class="content-card">
                        <h3>Informaci√≥n Personal</h3>
                        <form id="formEditarPerfil">
                            <!-- Foto de Perfil -->
                            <div class="form-group">
                                <label>Foto de Perfil</label>
                                <div class="foto-perfil-container">
                                    <div class="foto-perfil-preview" id="fotoPerfilPreview">
                                        <img id="fotoPerfilImg" src="" alt="Foto de perfil" style="display: none;">
                                        <div class="foto-perfil-placeholder" id="fotoPerfilPlaceholder">
                                            <span class="foto-icon">üë§</span>
                                            <span class="foto-text">Sin foto</span>
                                        </div>
                                    </div>
                                    <div class="foto-perfil-actions">
                                        <label for="inputFotoPerfil" class="btn btn-secondary btn-sm">
                                            üì∑ Cambiar Foto
                                        </label>
                                        <input type="file" id="inputFotoPerfil" accept="image/*" style="display: none;">
                                        <button type="button" class="btn btn-secondary btn-sm" id="btnEliminarFoto" style="display: none;">
                                            üóëÔ∏è Eliminar
                                        </button>
                                    </div>
                                </div>
                                <small class="form-help">Formatos permitidos: JPG, PNG, GIF. Tama√±o m√°ximo: 5MB</small>
                            </div>

                            <!-- Nombre Completo -->
                            <div class="form-group">
                                <label for="perfilNombreCompleto">Nombre Completo *</label>
                                <input 
                                    type="text" 
                                    id="perfilNombreCompleto" 
                                    name="nombre_completo"
                                    placeholder="Ingresa tu nombre completo"
                                    required
                                >
                            </div>

                            <!-- Email -->
                            <div class="form-group">
                                <label for="perfilEmail">Email</label>
                                <input 
                                    type="email" 
                                    id="perfilEmail" 
                                    name="email"
                                    placeholder="tu@email.com"
                                >
                            </div>

                            <!-- Tel√©fono -->
                            <div class="form-group">
                                <label for="perfilTelefono">Tel√©fono</label>
                                <input 
                                    type="tel" 
                                    id="perfilTelefono" 
                                    name="telefono"
                                    placeholder="1234567890"
                                >
                            </div>

                            <!-- Informaci√≥n de Usuario (solo lectura) -->
                            <div class="form-group">
                                <label>Usuario</label>
                                <input 
                                    type="text" 
                                    id="perfilUsuario" 
                                    value="{{ session.usuario }}"
                                    readonly
                                    class="input-readonly"
                                >
                                <small class="form-help">El nombre de usuario no se puede cambiar</small>
                            </div>

                            <!-- Rol (solo lectura) -->
                            <div class="form-group">
                                <label>Rol</label>
                                <input 
                                    type="text" 
                                    id="perfilRol" 
                                    value="Administrador"
                                    readonly
                                    class="input-readonly"
                                >
                            </div>

                            <!-- Botones de Acci√≥n -->
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="btnCancelarPerfil">Cancelar</button>
                                <button type="submit" class="btn btn-primary" id="btnGuardarPerfil">
                                    <span class="btn-text">üíæ Guardar Cambios</span>
                                    <span class="btn-loader" style="display: none;">‚è≥</span>
                                </button>
                            </div>
                        </form>
                        <div id="resultadoPerfil" class="resultado"></div>
                    </div>
                </div>
            </section>

            <!-- Caja Section -->
            <section id="section-caja" class="admin-section hidden">
                <div class="section-header">
                    <h2>üí∞ Caja - Recarga de Saldo</h2>
                    <p class="section-description">Recargue saldo a las tarjetas de los asistentes</p>
                </div>

                <div class="grid">
                    <!-- Formulario de Recarga -->
                    <div class="content-card">
                        <h3>Recargar Saldo</h3>
                        <form id="formRecargarCaja">
                            <!-- N√∫mero de Tarjeta -->
                            <div class="form-group">
                                <label for="numeroTarjetaCaja">N√∫mero de Tarjeta *</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input 
                                        type="text" 
                                        id="numeroTarjetaCaja" 
                                        name="numero_tarjeta"
                                        placeholder="TARJ-XXXXXX"
                                        required
                                        style="flex: 1;"
                                    >
                                    <button type="button" class="btn btn-secondary" id="btnEscanearQRCaja" title="Escanear QR">
                                        üì∑ Escanear QR
                                    </button>
                                </div>
                                <small class="form-help">Ingrese el n√∫mero de tarjeta o escanee el c√≥digo QR</small>
                            </div>

                            <!-- Informaci√≥n de Tarjeta (se muestra despu√©s de buscar) -->
                            <div id="infoTarjetaCaja" style="display: none; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid var(--accent-blue);">
                                <h4 style="margin: 0 0 10px 0;">Informaci√≥n de la Tarjeta</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <strong>Asistente:</strong>
                                        <span id="asistenteNombreCaja">-</span>
                                    </div>
                                    <div>
                                        <strong>Saldo Actual:</strong>
                                        <span id="saldoActualCaja" style="font-weight: bold; color: var(--accent-blue);">$-</span>
                                    </div>
                                    <div>
                                        <strong>Estado:</strong>
                                        <span id="estadoTarjetaCaja">-</span>
                                    </div>
                                    <div>
                                        <strong>N√∫mero:</strong>
                                        <span id="numeroTarjetaInfoCaja">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Monto a Recargar -->
                            <div class="form-group">
                                <label for="montoRecargaCaja">Monto a Recargar *</label>
                                <div style="position: relative;">
                                    <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #666;">$</span>
                                    <input 
                                        type="number" 
                                        id="montoRecargaCaja" 
                                        name="monto"
                                        placeholder="0.00"
                                        step="0.01"
                                        min="0.01"
                                        required
                                        style="padding-left: 25px;"
                                    >
                                </div>
                                <small class="form-help">Ingrese el monto a recargar (m√≠nimo $0.01)</small>
                            </div>

                            <!-- Botones de Acci√≥n -->
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="btnCancelarRecargaCaja">Limpiar</button>
                                <button type="submit" class="btn btn-primary" id="btnRecargarCaja">
                                    <span class="btn-text">üí∞ Recargar Saldo</span>
                                    <span class="btn-loader" style="display: none;">‚è≥</span>
                                </button>
                            </div>
                        </form>
                        <div id="resultadoRecargaCaja" class="resultado"></div>
                    </div>

                    <!-- Historial de Recargas Recientes -->
                    <div class="content-card">
                        <h3>Historial de Recargas Recientes</h3>
                        <div id="historialRecargasCaja">
                            <p style="color: #666; text-align: center; padding: 20px;">
                                Realice una recarga para ver el historial
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Punto de Venta Section -->
            <section id="section-punto-venta" class="admin-section hidden">
                <div class="section-header">
                    <h2>üõí Punto de Venta</h2>
                    <p class="section-description">Procese ventas y descuente saldo de tarjetas</p>
                </div>

                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Columna Izquierda: Selecci√≥n y Productos -->
                    <div>
                        <!-- Selector de Punto de Venta -->
                        <div class="content-card" style="margin-bottom: 20px;">
                            <h3>Seleccionar Punto de Venta</h3>
                            <div class="form-group">
                                <label for="puntoVentaSelect">Punto de Venta *</label>
                                <select id="puntoVentaSelect" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                    <option value="">Seleccione un punto de venta</option>
                                </select>
                                <small class="form-help">Seleccione el punto de venta donde se realizar√° la venta</small>
                            </div>
                        </div>

                        <!-- B√∫squeda de Tarjeta -->
                        <div class="content-card" style="margin-bottom: 20px;">
                            <h3>Buscar Tarjeta</h3>
                            <form id="formBuscarTarjetaPOS">
                                <div class="form-group">
                                    <label for="numeroTarjetaPOS">N√∫mero de Tarjeta *</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input 
                                            type="text" 
                                            id="numeroTarjetaPOS" 
                                            name="numero_tarjeta"
                                            placeholder="TARJ-XXXXXX"
                                            required
                                            style="flex: 1;"
                                        >
                                        <button type="button" class="btn btn-secondary" id="btnEscanearQRPOS" title="Escanear QR">
                                            üì∑ Escanear QR
                                        </button>
                                    </div>
                                    <small class="form-help">Ingrese el n√∫mero de tarjeta o escanee el c√≥digo QR</small>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary" id="btnBuscarTarjetaPOS">
                                        üîç Buscar Tarjeta
                                    </button>
                                </div>
                            </form>
                            
                            <!-- Informaci√≥n de Tarjeta -->
                            <div id="infoTarjetaPOS" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid var(--accent-blue);">
                                <h4 style="margin: 0 0 10px 0;">Informaci√≥n de la Tarjeta</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <strong>Asistente:</strong>
                                        <span id="asistenteNombrePOS">-</span>
                                    </div>
                                    <div>
                                        <strong>Saldo Disponible:</strong>
                                        <span id="saldoDisponiblePOS" style="font-weight: bold; color: var(--accent-blue); font-size: 1.2em;">$-</span>
                                    </div>
                                    <div>
                                        <strong>Estado:</strong>
                                        <span id="estadoTarjetaPOS">-</span>
                                    </div>
                                    <div>
                                        <strong>N√∫mero:</strong>
                                        <span id="numeroTarjetaInfoPOS">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Productos Disponibles -->
                        <div class="content-card">
                            <h3>Productos Disponibles</h3>
                            <div id="productosPOSContainer">
                                <p style="color: #666; text-align: center; padding: 20px;">
                                    Seleccione un punto de venta para ver los productos
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Columna Derecha: Carrito y Procesamiento -->
                    <div>
                        <!-- Carrito de Compras -->
                        <div class="content-card" style="margin-bottom: 20px;">
                            <h3>Carrito de Compras</h3>
                            <div id="carritoPOSContainer">
                                <p style="color: #666; text-align: center; padding: 20px;">
                                    El carrito est√° vac√≠o. Agregue productos para continuar.
                                </p>
                            </div>
                            <div id="resumenCarritoPOS" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <strong>Subtotal:</strong>
                                    <span id="subtotalCarritoPOS">$0.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 1.2em; font-weight: bold; color: var(--accent-blue); border-top: 2px solid var(--border); padding-top: 10px;">
                                    <strong>Total:</strong>
                                    <span id="totalCarritoPOS">$0.00</span>
                                </div>
                            </div>
                            <div class="form-actions" style="margin-top: 20px;">
                                <button type="button" class="btn btn-secondary" id="btnLimpiarCarritoPOS">Limpiar Carrito</button>
                                <button type="button" class="btn btn-primary" id="btnProcesarVentaPOS" disabled>
                                    üí≥ Procesar Venta
                                </button>
                            </div>
                        </div>

                        <!-- Historial de Ventas Recientes -->
                        <div class="content-card">
                            <h3>Ventas Recientes</h3>
                            <div id="historialVentasPOS">
                                <p style="color: #666; text-align: center; padding: 20px;">
                                    Realice una venta para ver el historial
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="section-configuracion" class="admin-section hidden">
                <h2>üîß Configuraci√≥n</h2>
                <div class="content-card">
                    <p>Opciones de configuraci√≥n pr√≥ximamente...</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para Agregar/Editar Asistente -->
    <div id="modalAsistenteAdmin" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAsistenteTitulo">‚ûï Registrar Nuevo Asistente</h2>
                <button class="modal-close" id="cerrarModalAsistenteAdmin">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formAsistenteAdmin" novalidate>
                    <div class="form-group">
                        <label for="asistenteNombreAdmin">Nombre Completo *</label>
                        <input 
                            type="text" 
                            id="asistenteNombreAdmin" 
                            required 
                            placeholder="Ej. Juan P√©rez Garc√≠a"
                            maxlength="100"
                        >
                        <small class="form-error" id="errorNombreAsistenteAdmin"></small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group form-col">
                            <label for="asistenteEmailAdmin">Email</label>
                            <input 
                                type="email" 
                                id="asistenteEmailAdmin" 
                                placeholder="ejemplo@correo.com"
                                maxlength="100"
                            >
                            <small class="form-help">Opcional</small>
                        </div>
                        <div class="form-group form-col">
                            <label for="asistenteTelefonoAdmin">Tel√©fono</label>
                            <input 
                                type="text" 
                                id="asistenteTelefonoAdmin" 
                                placeholder="Ej. 8441234567"
                                maxlength="20"
                            >
                            <small class="form-help">Opcional</small>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="btnCancelarAsistenteAdmin">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="btnGuardarAsistenteAdmin">
                            <span class="btn-text">Registrar Asistente</span>
                            <span class="btn-loader" style="display: none;">‚è≥</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar/Editar Producto -->
    <div id="modalProductoAdmin" class="modal">
        <div class="modal-content modal-producto">
            <div class="modal-header">
                <h2 id="modalProductoTitulo">‚ûï Agregar Nuevo Producto</h2>
                <button class="modal-close" id="cerrarModalProductoAdmin">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProductoAdmin" novalidate>
                    <input type="hidden" id="productoIdAdmin" value="">
                    
                    <!-- Nombre del Producto -->
                    <div class="form-group">
                        <label for="productoNombreAdmin">Nombre del Producto *</label>
                        <input 
                            type="text" 
                            id="productoNombreAdmin" 
                            required 
                            placeholder="Ej. Hamburguesa Cl√°sica"
                            maxlength="100"
                        >
                        <small class="form-error" id="errorNombreAdmin"></small>
                    </div>
                    
                    <!-- Categor√≠a y Punto de Venta en fila -->
                    <div class="form-row">
                        <div class="form-group form-col">
                            <label for="productoTipoAdmin">Categor√≠a *</label>
                            <select id="productoTipoAdmin" required>
                                <option value="">Seleccione una categor√≠a</option>
                                <option value="restaurante">üçΩÔ∏è Restaurante</option>
                                <option value="cafeteria">‚òï Cafeter√≠a</option>
                                <option value="souvenirs">üéÅ Souvenirs</option>
                                <option value="estacionamiento">üÖøÔ∏è Estacionamiento</option>
                                <option value="bebida">ü•§ Bebida</option>
                                <option value="comida">üçï Comida</option>
                                <option value="postre">üç∞ Postre</option>
                                <option value="snack">üçø Snack</option>
                                <option value="ropa">üëï Ropa</option>
                                <option value="otro">üì¶ Otros</option>
                            </select>
                            <small class="form-error" id="errorTipoAdmin"></small>
                        </div>
                        <div class="form-group form-col">
                            <label for="productoPuntoVentaAdmin">Punto de Venta</label>
                            <select id="productoPuntoVentaAdmin">
                                <option value="">Seleccione un punto de venta</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Precio y Estado en fila -->
                    <div class="form-row">
                        <div class="form-group form-col">
                            <label for="productoPrecioAdmin">Precio (MXN) *</label>
                            <div class="input-with-icon">
                                <span class="input-icon">$</span>
                                <input 
                                    type="number" 
                                    id="productoPrecioAdmin" 
                                    step="0.01" 
                                    min="0.01" 
                                    required 
                                    placeholder="0.00"
                                >
                            </div>
                            <small class="form-error" id="errorPrecioAdmin"></small>
                        </div>
                        <div class="form-group form-col">
                            <label>Estado</label>
                            <div class="switch-container">
                                <label class="switch">
                                    <input type="checkbox" id="productoActivoAdmin" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="switch-label" id="switchLabelAdmin">Activo</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Descripci√≥n -->
                    <div class="form-group">
                        <label for="productoDescripcionAdmin">Descripci√≥n (opcional)</label>
                        <textarea 
                            id="productoDescripcionAdmin" 
                            rows="3" 
                            placeholder="Ej. Porci√≥n individual, incluye bebida, ingredientes especiales..."
                            maxlength="500"
                        ></textarea>
                        <small class="char-count"><span id="charCountAdmin">0</span>/500 caracteres</small>
                    </div>
                    
                    <!-- Imagen del Producto -->
                    <div class="form-group">
                        <label for="productoImagenUrlAdmin">Imagen del Producto (opcional)</label>
                        <div class="imagen-upload-container">
                            <input 
                                type="url" 
                                id="productoImagenUrlAdmin" 
                                placeholder="https://ejemplo.com/imagen.jpg"
                                pattern="https?://.*"
                            >
                            <button type="button" class="btn btn-secondary btn-small" id="btnPreviewImagenAdmin">
                                Ver Preview
                            </button>
                        </div>
                        <div class="imagen-preview-container" id="productoImagenPreviewContainerAdmin">
                            <div class="imagen-preview-placeholder" id="productoImagenPreviewAdmin">
                                <span class="preview-icon">üñºÔ∏è</span>
                                <span class="preview-text">Sin imagen</span>
                            </div>
                        </div>
                        <small class="form-help">Ingresa la URL de una imagen. Se recomienda usar im√°genes 1:1 o 4:3 para evitar distorsi√≥n.</small>
                    </div>
                    
                    <!-- Opci√≥n para agregar otro -->
                    <div class="form-group checkbox-group">
                        <label class="checkbox-inline">
                            <input type="checkbox" id="productoAgregarOtroAdmin">
                            <span>Agregar otro producto despu√©s de guardar</span>
                        </label>
                    </div>
                    
                    <!-- Acciones -->
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="btnCancelarProductoAdmin">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="btnGuardarProductoAdmin">
                            <span class="btn-text">Agregar Producto</span>
                            <span class="btn-loader" style="display: none;">‚è≥</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>
    
    <!-- Modal para Escanear QR (solo para m√≥dulo de Tarjetas) -->
    <div id="modalScanQRTarjeta" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üì∑ Escanear C√≥digo QR de Tarjeta</h2>
                <button class="modal-close" id="cerrarModalScanQRTarjeta">&times;</button>
            </div>
            <div class="modal-body">
                <div id="qr-reader-tarjeta" style="width: 100%; min-height: 300px; background: #000; border-radius: 4px;"></div>
                <div id="qr-reader-status-tarjeta" style="text-align: center; margin-top: 10px; color: #666;">
                    <p>‚è≥ Iniciando c√°mara...</p>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <small>üí° <strong>Consejo:</strong> Aseg√∫rate de tener buena iluminaci√≥n y mantener el c√≥digo QR dentro del marco.</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts necesarios -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin-base.js') }}"></script>
    <!-- Script de dropdowns - debe ejecutarse despu√©s de admin-base.js -->
    <script>
        // Script de dropdowns del navbar - Sobrescribe cualquier inicializaci√≥n anterior
        (function() {
            'use strict';
            
            function initDropdowns() {
                console.log('[Dropdowns Navbar] Inicializando dropdowns del navbar...');
                
                // Seleccionar todos los elementos con clase dropdown en el navbar
                const dropdowns = document.querySelectorAll('.admin-nav-horizontal .nav-menu-item.dropdown');
                console.log('[Dropdowns Navbar] Dropdowns encontrados:', dropdowns.length);
                
                if (dropdowns.length === 0) {
                    console.warn('[Dropdowns Navbar] No se encontraron dropdowns en el navbar');
                    return;
                }
                
                dropdowns.forEach(function(dropdown, index) {
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    const menu = dropdown.querySelector('.dropdown-menu');
                    
                    if (!toggle || !menu) {
                        console.warn('[Dropdowns Navbar] Dropdown', index, 'sin toggle o menu');
                        return;
                    }
                    
                    const dropdownName = toggle.textContent.trim();
                    console.log('[Dropdowns Navbar] Configurando dropdown', index, ':', dropdownName);
                    
                    // Remover cualquier listener anterior
                    const newToggle = toggle.cloneNode(true);
                    toggle.parentNode.replaceChild(newToggle, toggle);
                    
                    // Guardar referencias
                    const menuRef = menu;
                    const dropdownRef = dropdown;
                    
                    // Evento click en el toggle
                    newToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation(); // Prevenir que otros handlers se ejecuten
                        
                        console.log('[Dropdowns Navbar] Click en:', dropdownName);
                        
                        const isShowing = menuRef.classList.contains('show');
                        console.log('[Dropdowns Navbar] Estado actual:', isShowing ? 'abierto' : 'cerrado');
                        
                        // Cerrar todos los otros dropdowns
                        document.querySelectorAll('.admin-nav-horizontal .dropdown-menu').forEach(function(m) {
                            if (m !== menuRef) {
                                m.classList.remove('show');
                            }
                        });
                        
                        // Toggle del dropdown actual
                        if (isShowing) {
                            menuRef.classList.remove('show');
                            console.log('[Dropdowns Navbar] Cerrado');
                        } else {
                            menuRef.classList.add('show');
                            console.log('[Dropdowns Navbar] Abierto - clase show agregada');
                            
                            // Verificaci√≥n despu√©s de un momento
                            setTimeout(function() {
                                const computed = window.getComputedStyle(menuRef);
                                console.log('[Dropdowns Navbar] Verificaci√≥n:');
                                console.log('  - Tiene clase show:', menuRef.classList.contains('show'));
                                console.log('  - Display:', computed.display);
                                console.log('  - Visibility:', computed.visibility);
                                console.log('  - Opacity:', computed.opacity);
                                console.log('  - Z-index:', computed.zIndex);
                            }, 50);
                        }
                    }, true); // Usar capture phase para ejecutarse primero
                    
                    // Evento hover
                    dropdownRef.addEventListener('mouseenter', function() {
                        const menu = this.querySelector('.dropdown-menu');
                        if (menu) {
                            menu.classList.add('show');
                            console.log('[Dropdowns Navbar] Hover - Menu mostrado');
                        }
                    });
                    
                    dropdownRef.addEventListener('mouseleave', function() {
                        const menu = this.querySelector('.dropdown-menu');
                        if (menu) {
                            menu.classList.remove('show');
                            console.log('[Dropdowns Navbar] Hover - Menu ocultado');
                        }
                    });
                });
                
                // Cerrar al hacer click fuera
                document.addEventListener('click', function(e) {
                    const clickedDropdown = e.target.closest('.admin-nav-horizontal .nav-menu-item.dropdown');
                    if (!clickedDropdown) {
                        document.querySelectorAll('.admin-nav-horizontal .dropdown-menu').forEach(function(menu) {
                            menu.classList.remove('show');
                        });
                    }
                });
                
                console.log('[Dropdowns Navbar] Inicializaci√≥n completa');
            }
            
            // Esperar a que el DOM y admin-base.js est√©n listos
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(initDropdowns, 500);
                });
            } else {
                setTimeout(initDropdowns, 500);
            }
            
            // Ejecutar tambi√©n despu√©s de m√°s tiempo para asegurar que todo est√© listo
            setTimeout(initDropdowns, 1000);
        })();
    </script>
    
    <!-- Script para dropdowns - MEJORADO Y FUNCIONAL -->
    <script>
        (function() {
            'use strict';
            
            function initDropdowns() {
                console.log('[Dropdowns] Inicializando dropdowns...');
                
                // Seleccionar todos los elementos con clase dropdown
                const dropdowns = document.querySelectorAll('.nav-menu-item.dropdown');
                console.log('[Dropdowns] Dropdowns encontrados:', dropdowns.length);
                
                if (dropdowns.length === 0) {
                    console.warn('[Dropdowns] No se encontraron dropdowns');
                    return;
                }
                
                dropdowns.forEach(function(dropdown, index) {
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    const menu = dropdown.querySelector('.dropdown-menu');
                    
                    if (!toggle || !menu) {
                        console.warn('[Dropdowns] Dropdown', index, 'sin toggle o menu');
                        return;
                    }
                    
                    console.log('[Dropdowns] Configurando dropdown', index, ':', toggle.textContent.trim());
                    console.log('[Dropdowns] Menu encontrado:', menu);
                    console.log('[Dropdowns] Menu display inicial:', window.getComputedStyle(menu).display);
                    
                    // Remover listeners anteriores si existen
                    const newToggle = toggle.cloneNode(true);
                    toggle.parentNode.replaceChild(newToggle, toggle);
                    
                    // Guardar referencia al menu para usar en el evento
                    const menuRef = menu;
                    const dropdownRef = dropdown;
                    
                    // Evento click en el toggle
                    newToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        console.log('[Dropdowns] Click en toggle:', this.textContent.trim());
                        console.log('[Dropdowns] Menu referencia:', menuRef);
                        console.log('[Dropdowns] Menu display antes:', window.getComputedStyle(menuRef).display);
                        console.log('[Dropdowns] Menu tiene clase show?', menuRef.classList.contains('show'));
                        
                        const isShowing = menuRef.classList.contains('show');
                        console.log('[Dropdowns] Estado actual:', isShowing ? 'abierto' : 'cerrado');
                        
                        // Cerrar todos los otros dropdowns
                        document.querySelectorAll('.dropdown-menu').forEach(function(m) {
                            if (m !== menuRef) {
                                m.classList.remove('show');
                            }
                        });
                        
                        // Toggle del dropdown actual
                        if (isShowing) {
                            menuRef.classList.remove('show');
                            console.log('[Dropdowns] Cerrado - clase show removida');
                        } else {
                            menuRef.classList.add('show');
                            console.log('[Dropdowns] Abierto - clase show agregada');
                            
                            // Verificar despu√©s de un momento
                            setTimeout(function() {
                                console.log('[Dropdowns] Verificaci√≥n - Menu display despu√©s:', window.getComputedStyle(menuRef).display);
                                console.log('[Dropdowns] Verificaci√≥n - Menu tiene clase show?', menuRef.classList.contains('show'));
                                console.log('[Dropdowns] Verificaci√≥n - Menu visibility:', window.getComputedStyle(menuRef).visibility);
                                console.log('[Dropdowns] Verificaci√≥n - Menu opacity:', window.getComputedStyle(menuRef).opacity);
                            }, 50);
                        }
                    });
                    
                    // Evento hover (opcional, para mejor UX)
                    dropdownRef.addEventListener('mouseenter', function() {
                        const menu = this.querySelector('.dropdown-menu');
                        if (menu) {
                            menu.classList.add('show');
                            console.log('[Dropdowns] Hover - Menu mostrado');
                        }
                    });
                    
                    dropdownRef.addEventListener('mouseleave', function() {
                        const menu = this.querySelector('.dropdown-menu');
                        if (menu) {
                            menu.classList.remove('show');
                            console.log('[Dropdowns] Hover - Menu ocultado');
                        }
                    });
                });
                
                // Cerrar al hacer click fuera
                document.addEventListener('click', function(e) {
                    const clickedDropdown = e.target.closest('.nav-menu-item.dropdown');
                    if (!clickedDropdown) {
                        document.querySelectorAll('.dropdown-menu').forEach(function(menu) {
                            menu.classList.remove('show');
                        });
                        console.log('[Dropdowns] Click fuera - Todos los dropdowns cerrados');
                    }
                });
                
                console.log('[Dropdowns] Inicializaci√≥n completa');
            }
            
            // Inicializar cuando el DOM est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initDropdowns);
            } else {
                initDropdowns();
            }
            
            // Tambi√©n ejecutar despu√©s de un delay para asegurar que todo est√© renderizado
            setTimeout(initDropdowns, 300);
            setTimeout(initDropdowns, 600);
        })();
    </script>
    </div> <!-- Cierre de admin-wrapper -->
    
    <!-- Footer Start -->
    <footer class="container-fluid bg-dark text-white py-5 px-sm-3 px-md-5">
        <div class="row pt-5">
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-primary mb-4">Contacto</h4>
                <p><i class="fa fa-map-marker-alt mr-2"></i>Saltillo, Coahuila, M√©xico</p>
                <p><i class="fa fa-phone-alt mr-2"></i>+52 844 XXX XXXX</p>
                <p><i class="fa fa-envelope mr-2"></i>info@tarjetasinteligentes.com</p>
                <div class="d-flex justify-content-start mt-4">
                    <a class="btn btn-outline-light rounded-circle text-center mr-2 px-0" style="width: 38px; height: 38px;" href="#"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-outline-light rounded-circle text-center mr-2 px-0" style="width: 38px; height: 38px;" href="#"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-outline-light rounded-circle text-center mr-2 px-0" style="width: 38px; height: 38px;" href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn btn-outline-light rounded-circle text-center mr-2 px-0" style="width: 38px; height: 38px;" href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-primary mb-4">Enlaces R√°pidos</h4>
                <div class="d-flex flex-column justify-content-start">
                    <a class="text-white mb-2" href="#dashboard"><i class="fa fa-angle-right mr-2"></i>Dashboard</a>
                    <a class="text-white mb-2" href="#asistentes"><i class="fa fa-angle-right mr-2"></i>Asistentes</a>
                    <a class="text-white mb-2" href="#tarjetas"><i class="fa fa-angle-right mr-2"></i>Tarjetas</a>
                    <a class="text-white mb-2" href="#productos"><i class="fa fa-angle-right mr-2"></i>Productos</a>
                    <a class="text-white" href="#reportes"><i class="fa fa-angle-right mr-2"></i>Reportes</a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-primary mb-4">M√≥dulos</h4>
                <div class="d-flex flex-column justify-content-start">
                    <a class="text-white mb-2" href="#caja"><i class="fa fa-angle-right mr-2"></i>Caja</a>
                    <a class="text-white mb-2" href="#punto-venta"><i class="fa fa-angle-right mr-2"></i>Punto de Venta</a>
                    <a class="text-white mb-2" href="#perfil"><i class="fa fa-angle-right mr-2"></i>Mi Perfil</a>
                    <a class="text-white mb-2" href="#configuracion"><i class="fa fa-angle-right mr-2"></i>Configuraci√≥n</a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-primary mb-4">Sistema</h4>
                <p>Sistema de Tarjetas Inteligentes para gesti√≥n de eventos y puntos de venta.</p>
                <p class="mb-0">Versi√≥n 1.0.0</p>
            </div>
        </div>
        <div class="container border-top border-secondary pt-5">
            <p class="m-0 text-center text-white">
                &copy; <a class="text-white font-weight-bold" href="#">Sistema de Tarjetas Inteligentes</a>. Todos los derechos reservados. 
                Dise√±ado para <a class="text-white font-weight-bold" href="#">Saltillo, Coahuila</a>
            </p>
        </div>
    </footer>
    <!-- Footer End -->
    
    <!-- Font Awesome para iconos del footer -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
</body>
</html>
